<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="p-8">
    <div class="max-w-4xl mx-auto">
        <header class="flex justify-between items-center mb-12">
            <h1 class="text-2xl font-black text-red-500 italic">ADMIN PANEL</h1>
            <button onclick="location.href='dash.html'" class="text-xs text-gray-500 uppercase tracking-widest">Dashboard</button>
        </header>

        <div id="reqContainer" class="space-y-4">
            </div>
    </div>

    <script>
        async function loadReqs() {
            const res = await fetch('http://localhost:3000/admin/requests', {
                headers: {'Authorization': localStorage.getItem('token')}
            });
            const reqs = await res.json();
            const container = document.getElementById('reqContainer');
            
            container.innerHTML = reqs.map(r => `
                <div class="glass p-6 flex justify-between items-center animate">
                    <div>
                        <p class="font-bold text-lg">${r.username}</p>
                        <p class="text-xs text-blue-500 font-mono">Plan demand√© : ${r.plan}</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="proc('${r.id}', 'accept')" class="btn-primary py-2 px-4 text-xs">ACCEPTER</button>
                        <button onclick="proc('${r.id}', 'decline')" class="bg-white/5 p-3 rounded-xl hover:bg-white/10 text-xs">REFUSER</button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        async function proc(id, action) {
            await fetch('http://192.168.1.17:3000/admin/process', {
                method: 'POST',
                headers: {
                    'Authorization': localStorage.getItem('token'),
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id, action })
            });
            loadReqs();
        }
        loadReqs();
    </script>
</body>
</html>
